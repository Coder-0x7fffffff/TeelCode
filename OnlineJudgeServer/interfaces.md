# OJ接口 v0.4

## 接口说明

返回值为**json**数据，输入参数中**加粗为必填参数**，*斜线为可选参数*
token也许可以不用带着(会在请求头中找)

## 更新日志

<font color="#00aa00">+增加删除题目的接口</font>
<font color="#00aa00">+增加删除分类的接口</font>
<font color="#00aa00">+增加获取题目提交记录的接口(某个题目所有的提交记录)</font>
<font color="#00aa00">+增加获取做题记录的接口(某个用户的做题记录)</font>

## 登陆相关

### 登陆(Login)

#### 输入

| 参数    | 类型   | 说明     |
| ------- | ------ | -------- |
| **id**  | 字符串 | 用户id   |
| **pwd** | 字符串 | 用户密码 |

#### 返回值

| 参数   | 类型     | 说明         |
| ------ | -------- | ------------ |
| result | 布尔类型 | 登陆是否成功 |
| token | 字符串 | 用户的token, 若登陆失败则为空 |

### 注册(Register)

#### 输入

| 参数    | 类型   | 说明     |
| ------- | ------ | -------- |
| **id**  | 字符串 | 用户id   |
| **pwd** | 字符串 | 用户密码 |
| **problem**  | 字符串 | 安全问题   |
| **answer** | 字符串 | 问题答案 |

#### 返回值

| 参数   | 类型     | 说明         |
| ------ | -------- | ------------ |
| result | 布尔类型 | 注册是否成功 |

## 用户相关

### 根据Token获取uid(GetUid)

#### 输入

| 参数     | 类型        | 说明     |
| -------- | ----------- | -------- |
| **token** | 字符串|用户的token|

#### 返回值

| 参数   | 类型     | 说明         |
| ------ | -------- | ------------ |
| uid | 字符串 | 用户id |

### 根据uid获取用户信息(GetUserInfo)

#### 输入

| 参数     | 类型        | 说明     |
| -------- | ----------- | -------- |
| **uid** | 字符串 |用户的id|

#### 返回值

| 参数   | 类型     | 说明         |
| ------ | -------- | ------------ |
| uid | 字符串 | 用户id |
| token | 字符串|用户的token|
| name | 字符串      | 用户昵称 |
| sex    | 整型        | 用户性别 |
| dscp  | 字符串/文本 | 用户描述 |
| question  | 字符串 | 安全问题   |
| answer | 字符串 | 问题答案 |
| img | 字符串 | 用户头像 |

### 创建用户(NewUser)

#### 输入

| 参数     | 类型        | 说明     |
| -------- | ----------- | -------- |
| **token** | 字符串|用户的token|
| **name** | 字符串      | 用户昵称 |
| *sex*    | 整型        | 用户性别 |
| *dscp*  | 字符串/文本 | 用户描述 |

#### 返回值

| 参数   | 类型     | 说明         |
| ------ | -------- | ------------ |
| result | 布尔类型 | 创建是否成功 |

###  更新用户信息(UpdateUser)

#### 输入

| 参数   | 类型        | 说明     |
| ------ | ----------- | -------- |
| **token** | 字符串  | 用户的token   |
| *name* | 字符串      | 用户昵称 |
| *sex*  | 整型        | 用户性别 |
| *dscp* | 字符串/文本 | 用户描述 |

#### 返回值

| 参数   | 类型     | 说明         |
| ------ | -------- | ------------ |
| result | 布尔类型 | 修改是否成功 |

### 修改密码(AlterPassword)

#### 输入

| 参数   | 类型        | 说明     |
| ------ | ----------- | -------- |
| **token** | 字符串  | 用户的token   |
| **answer** | 字符串 | 安全问题答案 |
| **newpwd** | 字符串  | 用户的新密码   |

#### 返回值

| 参数   | 类型     | 说明         |
| ------ | -------- | ------------ |
| result | 布尔类型 | 修改是否成功 |

### 获取做题记录(GetUserRecord)

#### 输入

| 参数     | 类型        | 说明     |
| -------- | ----------- | -------- |
| **token** | 字符串|用户的token|

#### 返回值

| 参数   | 类型     | 说明         |
| ------ | -------- | ------------ |
| passed | 数组 | AC的题目 |
| not_passed | 数组 | 未AC的题目 |

数组中的元素均为题号

## 题目相关

### 获取题目列表(All)

#### 输入

| 参数       | 类型 | 说明            |
| ---------- | ---- | --------------- |
| **token** | 字符串|用户的token|
| **page**   | 整型 | 第几页(从1开始) |
| **offset** | 整型 | 页大小          |
| **class** | 整型 | 分类          |
| **difficulty** | 整型 | 难度          |
| **status** | 整型 | 状态          |

#### 返回值

| 参数   | 类型     | 说明             |
| ------ | -------- | ---------------- |
| result | 题目数组 | 获取到的题目数组 |

##### 数组结构说明

每个元素都包含Problem和Classification两个字段(Classification可能为空,这意味着这个题目没有分类)

{ Problem:{pid,pname,pdifficulty,ppass,psubmit,pdscp,pinputs,poutputs}, classification:{cid,cname} }

字段具体含义同数据库表中字段

### 添加题目(AddProblem)

| 参数    |   类型   |  说明    |
| ---- | ---- | ---- |
| **token** | 字符串|用户的token|
| **id** | 整型 | 题目编号 |
| **name** | 字符串 | 题目名称 |
| **difficulty** | 整型 | 题目难度 |
| **dscp** | 字符串 | 题目描述 |
| **inputs** | 字符串 | 题目输入 |
| **outputs** | 字符串 | 题目输出 |
| *classification* | 字符串 | 题目分类 |

##### 题目分类说明

各个分类之间用英文逗号隔开,比如 链表,数组,...,树

#### 返回值

| 类型   | 参数   | 说明         |
| ------ | ------ | ------------ |
| 布尔型 | result | 添加是否成功 |

### 获取题目(GetProblem)

#### 输入

| 参数    |   类型   |  说明    |
| ---- | ---- | ---- |
| **token** | 字符串  | 用户的token   |
| **id** | 整型 | 题目编号 |

#### 返回值

| 参数   | 类型   | 说明         |
| ------ | ------ | ------------ |
| result | Json | 题目的Json |
Json 结构见 All 接口

### 获取题目提交记录(GetProblemRecord)

#### 输入

| 参数    |   类型   |  说明    |
| ---- | ---- | ---- |
| **token** | 字符串  | 用户的token   |
| **pid** | 整型 | 题目编号 |
| *uid* | 字符串 | 用户id |

如果给了用户id则表示获取该用户关于该题目的所有提交记录

#### 返回值

Record数组,结构和数据库Record表一样

### 获取题目数量(GetProblemCount)

#### 输入

| 参数      | 类型   | 说明        |
| --------- | ------ | ----------- |
| **token** | 字符串 | 用户的token |

#### 返回值

| 参数   | 类型 | 说明       |
| ------ | ---- | ---------- |
| count | 整型 | 下一个可用题目ID |

### 获取下一个可用题目ID(GetNextProblemId)

#### 输入

| 参数      | 类型   | 说明        |
| --------- | ------ | ----------- |
| **token** | 字符串 | 用户的token |

#### 返回值

| 参数   | 类型 | 说明       |
| ------ | ---- | ---------- |
| pid | 整型 | 下一个可用题目ID |


### 获取所有分类(GetClassifications)

#### 输入

| 参数         | 类型   | 说明       |
| ------------ | ------ | ---------- |
| **token** | 字符串  | 用户的token   |

#### 返回值

| 参数   | 类型 | 说明       |
| ------ | ---- | ---------- |
| result | 数组 | 所有的分类 |

##### 数组结构说明

数组中每个元素为Classification,定义同数据库的Classification表

### 添加分类(AddClassification)

#### 输入

| 参数     | 类型   | 说明         |
| -------- | ------ | ------------ |
| **token** | 字符串|用户的token|
| **id**   | 整型   | 该分类的编号 |
| **name** | 字符串 | 该分类的名字 |

#### 返回值

| 参数   | 类型   | 说明         |
| ------ | ------ | ------------ |
| result | 布尔型 | 添加是否成功 |

### 修改分类(AlterClassification)

#### 输入

| 参数   | 类型        | 说明     |
| ------ | ----------- | -------- |
| **token** | 字符串  | 用户的token   |
| **id** | 整型 | 分类id |
| **newcname** | 字符串  | 新分类名   |

#### 返回值

| 参数   | 类型     | 说明         |
| ------ | -------- | ------------ |
| result | 布尔类型 | 修改是否成功 |

### 获取所有难度(GetDifficulties)(0=简单，1=中等，2=困难)

#### 输入

| 参数         | 类型   | 说明       |
| ------------ | ------ | ---------- |
| **token** | 字符串  | 用户的token   |

#### 返回值

| 参数 | 类型 | 说明       |
| ---- | ---- | ---------- |
|      | 数组 | 所有的难度 |

0=全部，1=简单，2=中等，3=困难

### 删除题目(DeleteProblem)

#### 输入

| 参数      | 类型   | 说明        |
| --------- | ------ | ----------- |
| **token** | 字符串 | 用户的token |
| **id** | 整型 | 题目id |

#### 返回值

| 参数   | 类型     | 说明         |
| ------ | -------- | ------------ |
| result | 布尔类型 | 删除是否成功 |

### 删除分类(DeleteClassification)

#### 输入

| 参数      | 类型   | 说明        |
| --------- | ------ | ----------- |
| **token** | 字符串 | 用户的token |
| **id** | 整型 | 分类id |

#### 返回值

| 参数   | 类型     | 说明         |
| ------ | -------- | ------------ |
| result | 布尔类型 | 删除是否成功 |

## 提交相关

### 提交代码(Submit)

#### 输入

| 参数         | 类型   | 说明       |
| ------------ | ------ | ---------- |
| **token** | 字符串  | 用户的token   |
| **id**       | 整型   | 题目id     |
| **code**     | 字符串 | 代码       |
| **language** | 整型   | 使用的语言 |
| **time** | 字符串   | 提交的时间 |

使用的语言暂时没有返回接口,语言对应表

| 代码 | 语言    |
| ---- | ------- |
| 0    | c       |
| 1    | cpp     |
| 2    | java    |
| 3    | python2 |
| 4    | python3 |

#### 返回值

| 参数   | 类型 | 说明       |
| ------ | ---- | ---------- |
| count | 整型 | 样例个数 |
| 见下面说明 |      |          |
说明:除count外会返回count个对象,从**1**开始计数,结构如下

```
{"1": {"MemoryUsed": 2236, "ResultCode": 3, "ResultInfo": "", "TimeUsed": 2}, "2": {"MemoryUsed": 2236, "ResultCode": 3, "ResultInfo": "", "TimeUsed": 3}, "count": 2}
```

结构说明如下

| 参数   | 类型 | 说明       |
| ------ | ---- | ---------- |
| ResultCode | 整型 | 结果说明 |
| TimeUsed | 整型 | 使用的时间,单位是 MS |
| MemoryUsed | 整型 | 消耗的内存,单位是 KB |
| ResultInfo | 字符串 | 错误信息,如果没有错误则为空 |

code对应表如下

| 状态代码 | 状态名称 | 状态描述（参考牛客网）                                       |
| -------- | -------- | ------------------------------------------------------------ |
| 0        | 等待评测 | 评测系统还没有评测到这个提交，请稍候                         |
| 1        | 正在评测 | 评测系统正在评测，稍候会有结果                               |
| 2（CE）  | 编译错误 | 您提交的代码无法完成编译，点击“编译错误”可以看到编译器输出的错误信息 |
| 3（AC）  | 答案正确 | 恭喜！您通过了这道题                                         |
| 4（RE）  | 运行错误 | 您提交的程序在运行时发生错误,可能是空指针                    |
| 5（PE）  | 格式错误 | 您的程序输出的格式不符合要求（比如空格和换行与要求不一致）   |
| 6（WA）  | 答案错误 | 您的程序未能对评测系统的数据返回正确的结果                   |
| 7（TLE） | 运行超时 | 您的程序未能在规定时间内运行结束                             |
| 8（MLE） | 内存超限 | 您的程序使用了超过限制的内存                                 |

## 评论相关

### 添加评论(AddComment)

#### 输入

| 参数   | 类型 | 说明     |
| ------ | ---- | -------- |
| **token** | 字符串  | 用户的token   |
| **problem_id** | 整型 | 题目编号 |
| **username** | 整型 | 用户姓名 |
| **img** | 字符串 | 用户头像 |
| **time** | 字符串 | 评论发送时间 |
| **detail** | 字符串 | 评论内容 |
| **parent_comment_id** | 整型 | 根评论id |
| **reply_username** | 字符串 | 回复的用户姓名 |

#### 返回值

| 参数   | 类型 | 说明       |
| ------ | ---- | ---------- |
| err | 字符串 | 返回的错误信息 |
| cid | 整型 | 评论的id |

### 查询评论(GetComments)

#### 输入

| 参数   | 类型 | 说明     |
| ------ | ---- | -------- |
| **token** | 字符串  | 用户的token   |
| **problem_id** | 整型 | 题目编号 |
| **page**   | 整型 | 第几页(从1开始) |
| **offset** | 整型 | 页大小          |

#### 返回值

| 参数   | 类型 | 说明       |
| ------ | ---- | ---------- |
| err | 字符串 | 返回的错误信息 |
| comments | Json | 评论的Json |